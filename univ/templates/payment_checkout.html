{% extends 'base.html' %}

{% block content %}
<h3>Checkout — {{ course }}</h3>
<p>Amount: ₹{{ amount_rupees }}</p>

<!-- Razorpay checkout script -->
<form id="razorpay-form">
  <script src="https://checkout.razorpay.com/v1/checkout.js"
    data-key="{{ razorpay_key_id }}"
    data-amount="{{ amount_paise }}"
    data-currency="INR"
    data-order_id="{{ order_id }}"
    data-buttontext="Pay with Razorpay"
    data-name="Skillera University"
    data-description="Exam Fee"
    data-prefill.name="{{ request.user.get_full_name|default:request.user.username if request.user }}"
    data-theme.color="#0d6efd">
  </script>
  <input type="hidden" value="Hidden Element" name="hidden">
</form>

<script>
  // After payment completes, Razorpay will call the handler and post form data to verify endpoint
  // But razorpay automatically creates a payment and provides success handler here through form.
  // We'll capture payment details and send to backend verify endpoint using fetch.

  window.addEventListener('load', function () {
    // The checkout UI is automatically shown because of the script tag.
    // Attach a global handler: when Razorpay creates the payment, it will call success handler —
    // but since checkout.js inline config doesn't provide success callback here, we'll rely on
    // listening to the DOM for inputs created by the widget. Simpler approach: show a manual
    // verify button isn't needed. Instead rely on server side verify by fetching POST data
  });

  // A more robust integration is to create custom checkout options with a handler function.
</script>

<p class="mt-3"><a href="{% url 'exam_fees' %}" class="btn btn-secondary">Back</a></p>

{% endblock %}